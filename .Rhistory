ncdf4::nc_close(nc)
ERA_read <- function(x) {
nc <- ncdf4::nc_open(x)
var.name <- names(nc[['var']])[1]
ncdf4::nc_close(nc)
dat <- rotate(brick(x, varname= var.name))
datC <- crop(dat, ext)
return(datC)
}
ERA5 <- readRDS("Rdata_SH/ERA5_t2m_1979_SH.rds")
coasts <- ne_coastline(scale=50, "sp")
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
coasts <- ne_coastline(scale=50, "sp")
coasts <- crop(coasts, ext)
plot(d18o$X1958.01.15) +
layer(sp.polygons(coasts, lwd=1))
d18o <- readRDS("d18o.rds")
coasts <- ne_coastline(scale=50, "sp")
coasts <- crop(coasts, ext)
plot(d18o$X1958.01.15) +
layer(sp.polygons(coasts, lwd=1))
coasts <- ne_coastline(scale=50, "sp")
coasts <- crop(coasts, ext)
plot(d18o$X1958.01.15)
plot(sp.polygons(coasts, lwd=1))
d18o.file <- "data/Echam5-wiso.PD_nudged.d18O_prec.nc"
evap.file <- "data/Echam5-wiso.PD_nudged.evap.nc"
precip.file <- "data/Echam5-wiso.PD_nudged.prec.nc"
tsurf.file <- "data/Echam5-wiso.PD_nudged.tsurf.nc"
soilw.file <- "data/Echam5-wiso.PD_nudged.ws.nc"
F_yr <- 1958
L_yr <- 2013
years <- seq(F_yr, L_yr)
ext <- extent(0, 180, -90, 0)
#ext <- extent(0, 180, -90, 0) #SH extent
#ext <- extent(143.5, 148.6, -43.8, -39.5) #TAS Extent
coasts <- ne_coastline(scale=50, "sp")
coasts <- crop(coasts, ext)
plot(d18o$X1958.01.15)
plot(sp.polygons(coasts, lwd=1))
ar.18o <- as.array(d18o)
ar.18o[,,1]
MRD_18o <- ar.18o[2,2,]
plot(d18o)
F_yr <- 1958
L_yr <- 2013
years <- seq(F_yr, L_yr)
ext <- extent(0, 180, -90, 0)
#ext <- extent(0, 180, -90, 0) #SH extent
#ext <- extent(143.5, 148.6, -43.8, -39.5) #TAS Extent
ERA_t_79 <- readRDS("Rdata_SH/ERA5_t2m_1979_SH.rds")
ERA_t_50 <- readRDS("Rdata_SH/ERA5_t2m_1950_SH.rds")
s <- stack(ERA_t_50, ERA_t_79)
nlayers(s)
View(s)
s <- stack(ERA_t_50, ERA_t_79)
nlayers(s)
b <- brick(s)
s <- stack(ERA_t_50, ERA_t_79)
nlayers(s)
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
d18o <- readRDS("d18o.rds")
ERA_t_79 <- readRDS("Rdata_SH/ERA5_t2m_1979_SH.rds")
ERA_t_50 <- readRDS("Rdata_SH/ERA5_t2m_1950_SH.rds")
ar.18o <- as.array(d18o)
MRD_18o <- ar.18o[2,2,]
s <- stack(ERA_t_50, ERA_t_79)
nlayers(s)
ERA_t2m <- brick(s)
ERA_t2m <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_t2m)
sel <- subset(ERA_t2m, 97:498)
sel <- subset(ERA_t2m, 97:770)
sel <- subset(ERA_t2m, 97:768)
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
ERA_t2m <- subset(ERA_temp, 97:768)
ar.t2m <- as.array(ERA_t2m)
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
ERA5.file <- "data/Echam5_d18o.nc"
d18o <- readRDS("d18o.rds")
ERA_t_79 <- readRDS("Rdata_SH/ERA5_t2m_1979_SH.rds")
ERA_t_50 <- readRDS("Rdata_SH/ERA5_t2m_1950_SH.rds")
ar.18o <- as.array(d18o)
MRD_18o <- ar.18o[2,2,]
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
ERA_t2m <- subset(ERA_temp, 97:768)
ar.t2m <- as.array(ERA_t2m)
ar.t2m <- raster::as.array(ERA_t2m)
install.packages("raster")
install.packages("raster")
install.packages("raster")
install.packages("raster")
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
d18o <- readRDS("d18o.rds")
ERA_t_79 <- readRDS("Rdata_SH/ERA5_t2m_1979_SH.rds")
ERA_t_50 <- readRDS("Rdata_SH/ERA5_t2m_1950_SH.rds")
ar.18o <- as.array(d18o)
MRD_18o <- ar.18o[2,2,]
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
ERA_t2m <- subset(ERA_temp, 97:768)
ar.t2m <- as.array(ERA_t2m)
removeTmpFiles(h=0)
ar.t2m <- as.array(ERA_t2m)
ar.t2m <- as.array(ERA_t_50)
ar.t2m <- as.array(ERA_t2m)
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
d18o <- readRDS("d18o.rds")
ERA_t_79 <- readRDS("Rdata_SH/ERA5_t2m_1979_SH.rds")
ERA_t_50 <- readRDS("Rdata_SH/ERA5_t2m_1950_SH.rds")
ar.18o <- as.array(d18o)
MRD_18o <- ar.18o[2,2,]
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
ERA_t2m <- subset(ERA_temp, 97:768)
ar.t2m <- as.array(ERA_t2m)
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
ERA5.file <- "data/ERA5_prcp_1950.nc"
ERA5.file2 <- "data/ERA5_prcp_1979.nc"
F_yr <- 1958
L_yr <- 2013
years <- seq(F_yr, L_yr)
ext <- extent(0, 180, -90, 0)
#ext <- extent(0, 180, -90, 0) #SH extent
#ext <- extent(143.5, 148.6, -43.8, -39.5) #TAS Extent
ERA_read <- function(x) {
nc <- ncdf4::nc_open(x)
var.name <- names(nc[['var']])[1]
ncdf4::nc_close(nc)
dat <- rotate(brick(x, varname= var.name))
datC <- crop(dat, ext)
return(datC)
}
ERA_t_50 <- ERA_read(ERA5.file)
ERA_t_79 <- ERA_read(ERA5.file2)
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
writeRaster(ERA_temp, "ERA5_precip")
ERA_precip <- raster("ERA5_precip.gri")
View(ERA_precip)
ERA_precip <- brick("ERA5_precip.gri")
View(ERA_precip)
plot(ERA_precip)
plot(ERA_precip$X1950.01.01.00.00.00)
ERA5.file <- "data/ERA5_t2m_1950.nc"
ERA5.file2 <- "data/ERA5_t2m_1979.nc"
ERA_t_50 <- ERA_read(ERA5.file)
ERA_t_79 <- ERA_read(ERA5.file2)
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
writeRaster(ERA_temp, "ERA5_t2m")
ERA_precip <- brick("ERA5_t2m.gri")
ERA_t2m <- brick("ERA5_t2m.gri")
plot(ERA_t2m)
ERA5.file <- "data/ERA5_RH_1950.nc"
ERA5.file2 <- "data/ERA5_RH_1979.nc"
ERA_t_50 <- ERA_read(ERA5.file)
ERA_t_79 <- ERA_read(ERA5.file2)
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
writeRaster(ERA_temp, "ERA5_RH")
ERA_precip <- brick("data/ERA5_precip.gri")
ERA_t2m <- brick("data/ERA5_t2m.gri")
d18o <- readRDS("d18o.rds")
ar.18o <- as.array(d18o)
MRD_18o <- ar.18o[2,2,]
ERA_t2m_sub <- subset(ERA_t2m, 97:768)
ERA_t2m_sub <- subset(ERA_t2m, 97:768)
ERA_precip_sub <- subset(ERA_precip, 97:768)
ar.t2m <- as.array(ERA_t2m_sub)
ar.prcp <- as.array(ERA_precip_sub)
apply(ar.t2m, 1:2, rcorr, MRD_18o, type="pearson")
z <- apply(ar.t2m, 1:2, rcorr, MRD_18o, type="pearson")
extent(ERA_precip$X1950.01.01.00.00.00)
ERA_precip$X1950.01.01.00.00.00
corr = array(0, dim=c(360,720) )
sig = array(0, dim=c(360,720) )
for (x in 1:259200)
{
corr[x] <- z[[x]][[1]][2]
sig[x] <- z[[x]][[3]][2]
}
head(corr)
head(sig)
l <- list(corr, sig)
a <- do.call(rbind, l)
library(abind)
a <- abind(l, along=3)
a
r <- brick(a, xmn=0.125, xmx=180.125, ymn=-89.875, ymx=0,125, crs=CRS("+proj=longlat +datum=WGS84"))
r
plot(r)
plot(ERA_t2m_sub$X1958.01.01.00.00.00)
t(apply(ar.t2m, 1:2, rcorr, MRD_18o, type="pearson"))
z <- t(apply(ar.t2m, 1:2, rcorr, MRD_18o, type="pearson"))
corr = array(0, dim=c(360,720) )
sig = array(0, dim=c(360,720) )
for (x in 1:259200)
{
corr[x] <- z[[x]][[1]][2]
sig[x] <- z[[x]][[3]][2]
}
l <- list(corr, sig)
a <- do.call(rbind, l)
library(abind)
a <- abind(l, along=3)
a
r <- brick(a, xmn=0.125, xmx=180.125, ymn=-89.875, ymx=0,125, crs=CRS("+proj=longlat +datum=WGS84"))
r
plot(r)
z <- apply(ar.t2m, 1:2, rcorr, MRD_18o, type="pearson")
corr = array(0, dim=c(360,720) )
sig = array(0, dim=c(360,720) )
for (x in 1:259200)
{
corr[x] <- z[[x]][[1]][2]
sig[x] <- z[[x]][[3]][2]
}
corr <- t(corr)
sig <- t(sig)
l <- list(corr, sig)
a <- do.call(rbind, l)
library(abind)
a <- abind(l, along=3)
a
r <- brick(a, xmn=0.125, xmx=180.125, ymn=-89.875, ymx=0,125, crs=CRS("+proj=longlat +datum=WGS84"))
r
plot(r)
z <- apply(ar.t2m, 1:2, rcorr, MRD_18o, type="pearson")
corr = array(0, dim=c(360,720) )
sig = array(0, dim=c(360,720) )
for (x in 1:259200)
{
corr[x] <- z[[x]][[1]][2]
sig[x] <- z[[x]][[3]][2]
}
corr2 <- t(corr)
sig2 <- t(sig)
corr
aperm(corr)
corr
aperm(corr, c(2,1,3))
View(corr)
View(corr2)
z <- apply(ar.t2m, 1:2, rcorr, MRD_18o, type="pearson")
corr = array(0, dim=c(360,720) )
sig = array(0, dim=c(360,720) )
for (x in 1:259200)
{
corr[x] <- z[[x]][[1]][2]
sig[x] <- z[[x]][[3]][2]
}
corr <- t(corr)
sig <- t(sig)
l <- list(corr, sig)
a <- do.call(rbind, l)
library(abind)
a <- abind(l, along=3)
a
r <- brick(a, xmn=0.125, xmx=180.125, ymn=-89.875, ymx=0,125, crs=CRS("+proj=longlat +datum=WGS84"))
r
plot(r)
writeRaster(r, "o18_t2m_corr")
z <- apply(ar.prcp, 1:2, rcorr, MRD_18o, type="pearson")
corr = array(0, dim=c(360,720) )
sig = array(0, dim=c(360,720) )
for (x in 1:259200)
{
corr[x] <- z[[x]][[1]][2]
sig[x] <- z[[x]][[3]][2]
}
corr <- t(corr)
sig <- t(sig)
l <- list(corr, sig)
a <- do.call(rbind, l)
library(abind)
a <- abind(l, along=3)
a
r <- brick(a, xmn=0.125, xmx=180.125, ymn=-89.875, ymx=0,125, crs=CRS("+proj=longlat +datum=WGS84"))
r
plot(r)
writeRaster(r, "o18_prcp_corr")
names(datC)
names(ERA_precip)
substr(names(datC), 7, 8) %in% month
substr(names(ERA_precip), 7, 8) %in% month
month <- "12"
substr(names(ERA_precip), 7, 8) %in% month
ERA_precip <- brick("data/ERA5_precip.gri")
ERA_t2m <- brick("data/ERA5_t2m.gri")
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
ERA5.file <- "data/ERA5_RH_1950.nc"
ERA5.file2 <- "data/ERA5_RH_1979.nc"
F_yr <- 1958
L_yr <- 2013
years <- seq(F_yr, L_yr)
ext <- extent(143.5, 148.6, -43.8, -39.5)
#ext <- extent(0, 180, -90, 0) #SH extent
#ext <- extent(143.5, 148.6, -43.8, -39.5) #TAS Extent
ERA_read <- function(x) {
nc <- ncdf4::nc_open(x)
var.name <- names(nc[['var']])[1]
ncdf4::nc_close(nc)
dat <- rotate(brick(x, varname= var.name))
datC <- crop(dat, ext)
return(datC)
}
ERA_t_50 <- ERA_read(ERA5.file)
ERA_t_79 <- ERA_read(ERA5.file2)
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
plot(ERA_temp)
writeRaster(ERA_temp, "ERA5_RH_TAS")
ERA5.file <- "data/ERA5_t2m_1950.nc"
ERA5.file2 <- "data/ERA5_t2m_1979.nc"
F_yr <- 1958
L_yr <- 2013
years <- seq(F_yr, L_yr)
ext <- extent(143.5, 148.6, -43.8, -39.5)
#ext <- extent(0, 180, -90, 0) #SH extent
#ext <- extent(143.5, 148.6, -43.8, -39.5) #TAS Extent
ERA_t_50 <- ERA_read(ERA5.file)
ERA_t_79 <- ERA_read(ERA5.file2)
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
writeRaster(ERA_temp, "ERA5_t2m_TAS")
ERA5.file <- "data/ERA5_prcp_1950.nc"
ERA5.file2 <- "data/ERA5_prcp_1979.nc"
F_yr <- 1958
L_yr <- 2013
years <- seq(F_yr, L_yr)
ext <- extent(143.5, 148.6, -43.8, -39.5)
#ext <- extent(0, 180, -90, 0) #SH extent
#ext <- extent(143.5, 148.6, -43.8, -39.5) #TAS Extent
ERA_t_50 <- ERA_read(ERA5.file)
ERA_t_79 <- ERA_read(ERA5.file2)
ERA_temp <- stack(ERA_t_50, ERA_t_79)
nlayers(ERA_temp)
writeRaster(ERA_temp, "ERA5_prcp_TAS")
brick("ERA5_prcp_TAS.gri")
select <- brick("ERA5_prcp_TAS.gri")
plot(select$X1950.01.01.00.00.00)
plot(select$X1951.01.01.00.00.00)
select <- brick("ERA5_RH_TAS.gri")
plot(select$X1951.01.01.00.00.00)
plot(select$X1951.06.01.00.00.00)
plot(select$X1951.01.06.00.00.00)
plot(select$X1950.08.01.01.00.00)
plot(select$X1950.08.01.01.00.00)
axis(side=1, at=c(142:150))
plot(select$X1950.08.01.01.00.00)
axis(side=0.5, at=c(142:150))
plot(select$X1950.08.01.01.00.00)
axis(side=1, at=seq(143,149, by=0.5)
plot(select$X1950.08.01.01.00.00)
axis(side=1, at=seq(143,149, by=0.5))
plot(select$X1950.08.01.01.00.00)
axis(side=1, at=seq(143,149, by=0.25))
plot(select$X1950.08.01.01.00.00)
axis(side=1, at=seq(143,149, by=0.25))
axis(side=2, at=seq(-43,-40, by=0.25))
select$X1950.08.01.01.00.00
select$X1950.08.01.01.00.00[,,1]
as.array(select$X1950.08.01.01.00.00)
select <- brick("ERA5_RH_TAS.gri")
ar.test <- as.array(select)
MRD_RH <- ar.test[10,8,]
MRD_RH
write.csv(MRD_RH, file="MRD_RH.csv")
select <- brick("ERA5_t2m_TAS.gri")
ar.test <- as.array(select)
MRD_RH <- ar.test[10,8,]
write.csv(MRD_RH, file="MRD_t2m.csv")
select <- brick("ERA5_prcp_TAS.gri")
ar.test <- as.array(select)
MRD_RH <- ar.test[10,8,]
write.csv(MRD_RH, file="MRD_prcp.csv")
ar.18o <- as.array(d18o)
d18o <- readRDS("d18o.rds")
ar.18o <- as.array(d18o)
MRD_18o <- ar.18o[2,2,]
write.csv(MRD_18o, file="MRD_d18o.csv")
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
ERA5.file <- "data/ERA5_prcp_1950.nc"
ERA5.file2 <- "data/ERA5_prcp_1979.nc"
nc <- ncdf4::nc_open(ERA5.file)
#select the variable
var.name <- names(nc[['var']])[1] #be sure this is the value you want
summary(nc$dim$lon$vals) #if longitude is 0-360 needs to be rotated
tunits <- ncdf4::ncatt_get(nc, "time", "units")
print(tunits)
ncdf4::nc_close(nc)
library(ncdf4)
library(raster)
library(lubridate)
library(ggplot2)
library(lattice)
library(rnaturalearth)
library(rnaturalearthdata)
library(rasterVis)
library(viridis)
library(seas)
library(s2dverification)
library(reshape2)
library(dplyr)
library(Hmisc)
